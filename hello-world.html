<!DOCTYPE html>
<!-- HTML5 Hello world by kirupa - http://www.kirupa.com/html5/getting_your_feet_wet_html5_pg1.htm -->
<html lang="en-us">

<head>
<meta charset="utf-8">
<title>Hello...</title>
<style type="text/css">
#mainContent {
	font-family: Arial, Helvetica, sans-serif;
	font-size: xx-large;
	font-weight: bold;
	background-color: #E3F0FB;
	border-radius: 4px;
	padding: 10px;
	text-align: center;
}
.buttonStyle {
	border-radius: 4px;
	border: thin solid #F0E020;
	padding: 5px;
	background-color: #F8F094;
	font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
	font-weight: bold;
	color: #663300;
	width: 75px;
}

.buttonStyle:hover {
	border: thin solid #FFCC00;
	background-color: #FCF9D6;
	color: #996633;
	cursor: pointer;
}
.buttonStyle:active {
	border: thin solid #99CC00;
	background-color: #F5FFD2;
	color: #669900;
	cursor: pointer;
}

</style>
</head>

<body>
<div id="mainContent">
<p id="helloText">Laptop Comparison Super Program</p>
<label id="debug"></label>
<button id="clickButton" class="buttonStyle">click me</button>
</div>
<div id="topstuff">
       
<input type="file" id="fileInput">
</div>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"> </script>

<script src="http://snapsvg.io/assets/js/snap.svg-min.js"></script>

<script> 

var myButton = document.getElementById("clickButton");
var myText = document.getElementById("helloText");

myButton.addEventListener('click', doSomething, false)

function doSomething() {
	myText.textContent = "חחח";
}

var winX=1200;
var winY=400;
var xMargin=20;
var yMargin=20;
var baseline=winY-3*yMargin;
var spacing=20;
var lapTop=[];
var tl //number of laptops in file
var scaling;
var originalOpacity;

var drag = d3.behavior.drag()  
            // .on('dragstart', function() { originalOpacity=d3.select(this).style("fill-opacity")});
             .on('drag', function() { d3.select(this).attr('x', d3.event.x)
                                            .attr('y', d3.event.y); });
            // .on('dragend', function() { lpBoxes.style('fill', 'black'); });


var svgContainer = d3.select("body").append("svg")
                                     .attr("id", "svg1")
                                     //.on("dblclick", createLaptop)
                                     .attr("width", winX)
                                     .attr("height", winY)
                                     .attr("align","center")
                                     .style("fill", "red")
                                     .style("border", "1px solid black");


var laptopCollection = svgContainer.append("g")
                                    .attr("id", "laptops")                         
//var s = Snap("#laptops");



window.onload = function() {
    var fileInput = document.getElementById('fileInput');

    fileInput.addEventListener('change', function(e) {
          var file = fileInput.files[0];
        var textType = /text.*/;
          if (file.type.match(textType)) {
              
  var reader = new FileReader();

  reader.onload = function(e) {
   // fileDisplayArea.innerText = reader.result;
      fileContent=reader.result;
      test = fileContent.split("\n"); //test array holds lines of laptops
      tl=test.length-2;
      console.log(tl);
      for (i=0;i<tl;i++)
      {
      textlp=test[i+1].split(",");
      console.log(i+" "+textlp);
      lapTop[i]=new Object();
      lapTop[i].model=textlp[0];
      lapTop[i].lpx=+textlp[1];
      lapTop[i].lpy=+textlp[2];
      lapTop[i].lpz=+textlp[3];
      lapTop[i].weight=+textlp[4];
      
      }
  lapTop.sort(function(a,b){return a.weight-b.weight});
  var xNeeded=2; //width of all laptops combined
  
  for (i=0;i<tl;i++){
      xNeeded=xNeeded+lapTop[i].lpx;
      
  }
 spacing=(winX-2*xMargin)/(tl);
 scaling=(winX-2*xMargin)/(xNeeded+tl);
 
 
 
 var lpBoxes=laptopCollection.selectAll("rect")
                                    .data(lapTop)
                                    .enter()
                                    .append("rect")
                                    

var lpBoxesAttrubutes=lpBoxes
                      .attr("x",function(d,i){return Math.round(xMargin+(i)*spacing);})
                      .attr("y", baseline-150)
                      .attr("height", function(d){return Math.round(d.lpy*scaling);})
                      .attr("width", function(d){return Math.round(d.lpx*scaling);})
                      .call(drag)
                      .style("fill",function() { return "hsl(" + Math.random() * 360 + ",100%,50%)";})
                      .style("fill-opacity",function(d){return Math.pow((d.weight+1),3)/100}) 
                      .style("stroke","black")
                      .append("title")
                      .text(function(d){return d.weight});

 var lpText=laptopCollection.selectAll("text")
                                    .data(lapTop)
                                    .enter()
                                    .append("text")
                                    

var lpTextAttrubutes=lpText
                      .attr("x",function(d,i){return Math.round(xMargin+(i)*spacing);})
                      .attr("y", winY-50)
                      .attr("font-family", "sans-serif")                
                      .attr("font-size", "12px")
                      .attr("fill", "black")
                      .text(function(d) {return d.model+" "+parseFloat(Math.round(d.weight * 100/2.2) / 100).toFixed(2)+" Kg";});
              
  }

  reader.readAsText(file);
  
                                    
                                    
  
  
} else {
  fileDisplayArea.innerText = "File not supported!";
}
    });
}   

</script>

</body>
</html>
